# 插件更新循环

因为存在版本号系统，在应用启动时。需要对比本地安装的插件版本，来确认是否可升级。

## 应用启动时

在等待本地插件数据库读取/远程商店插件拉取完毕后（module/index.ts）。

`pluginService` 会根据商店的所有插表生成的 `插件ID/插件信息` 的键值对对象。来初始化本地插件/商店的的安装信息（`pluginService.setPluginInstallInfo`），更新内存中的数据信息。

此时渲染进程启动，获取到的插件/商店插件列表数据就是包含最新安装信息的数据。

##  在插件列表/商店列表发生更新时

应用存在安装/下载/删除/更新/发布插件的行为，发生这样行为时，列表的数据需要保证更新为最新的。代码内会进行如下循环🔁。

1. 优先完成安装/下载/删除/更新的业务逻辑，并更新到对应的数据库（本地数据库/远程数据库）
2. 执行完步骤1后，会根据情况来执行 `pluginService.initPluginInstallInfo` 或 `pluginService.setPluginInstallInfo` 方法，来更新插件的安装信息。
3. 此时主线程中数据为最新，渲染进程主动拉取主进程最新数据，完成插件更新循环。

##  手动触发商店更新

在用户手动进行商店刷新时，会调用 `pluginService.initPluginInstallInfo` 来完成重新拉取商店插件——初始化本地插件/商店的安装信息。再获取主进程中内存的数据。
